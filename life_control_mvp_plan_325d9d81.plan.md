---
name: Life Control самопис план
overview: "Единый план самописки на базе LifeForge: доки, планеры из !EXCEL (спиздить структуру), стили из ! Cyberpunk UI и !liquidglass, русская локаль, киберпанк-тема, задачи/привычки/заморозка с СДВГ-френдли (Мой день, быстрый захват, подзадачи, Kanban/Календарь, поощрительная геймификация, принцип перезапуска), графики, блокнот/дневник побед, пиксельный персонаж, импорт Excel, инвайты, опционально психология/таро, магазин, ИИ-декомпозиция задач. Один forgeAPI, без прямого PocketBase с клиента. По одной фиче на агента."
todos: []
---

# План: самопис Life Control на базе LifeForge

**Не форк — самопис:** берём код и архитектуру LifeForge как основу, отбрасываем лишнее (2FA, API Keys crypto, ненужные модули), делаем только то, что нужно: привычки, задачи, графики, блокнот, киберпанк-UI, мобилка, опционально персонаж/инвайты/психология.

---

## 0. Обязательные референсы (читать агенту в начале)

- **Документация:** [!!!DOCUMENTATIONS.TXT](!!!DOCUMENTATIONS.TXT) — установка, env, Forge CLI, модули (client manifest, server routes, schema), Consuming APIs, локали, db init. При проблемах с `db init` (400 на Windows) — проверять env (PB_PASSWORD без кавычек/BOM), передачу пароля в superuser.
- **Планеры (структуру спиздить):** папка [!EXCEL](!EXCEL):
- `SKLADCHIKI.PRO [Цвет] Планер Задач.xlsx` — листы/колонки под задачи
- `SKLADCHIKI.PRO [Цвет] Трекер привычек.xlsx` — под привычки
- `SKLADCHIKI.PRO [Цвет] Планер финансов.xlsx`, `Финансовый Учёт (1).xlsx` — под финансы (если понадобится)
Перед импортом Excel: открыть каждый файл, зафиксировать структуру (листы → колонки), маппинг «колонка → поле коллекции» для импорта в PocketBase.
- **Киберпанк UI (спиздить стили):** папка [! Cyberpunk UI](!%20Cyberpunk%20UI) — файлы `example1.txt` … `example21.txt`: CSS-примеры (формы, кнопки, заголовки, clip-path, глитчи, цвета — yellow/orange/green/red/blue). Использовать как референс для классов и переменных; не дублировать — интегрировать в [packages/lifeforge-ui](packages/lifeforge-ui) (уже есть [cyberpunk.css](packages/lifeforge-ui/src/styles/cyberpunk.css), [GlassCard](packages/lifeforge-ui/src/components/GlassCard.tsx), [NeonButton](packages/lifeforge-ui/src/components/NeonButton.tsx), [CPProgressBar](packages/lifeforge-ui/src/components/CPProgressBar.tsx)).
- **Liquid glass:** папка [!liquidglass](!liquidglass) — референсы для «жидкого стекла»; в коде уже [glassmorphism.css](packages/lifeforge-ui/src/styles/glassmorphism.css).
- **Твой предыдущий план (полное содержание учтено здесь):** [lifeforge_fork_план_d6bc7477.plan.md](c:\Users\wonderluverz\.cursor\plans\lifeforge_fork_план_d6bc7477.plan.md) — русская локаль, тема, Excel, задачи/привычки/заморозка, персонаж, заметки, инвайты, психология, магазин, лучшие практики (forgeAPI, без прямого PB), риски.
- **СДВГ-френдли таск-трекеры (что взять):** отчёт «Топ-10 таск-трекеров для СДВГ» (файл в Downloads). Ключевые идеи: низкий барьер захвата задачи (1–2 клика, быстрый ввод), вид «Мой день» (фокус на сегодня без перегруза), принцип «перезапуска» (легко вернуться после выпадения), геймификация поощрительная по умолчанию (без карательных штрафов за пропуски), опционально Pomodoro/таймер фокуса, подзадачи, виды Список/Kanban/Календарь, ИИ-декомпозиция задачи (Goblin.Tools-style). См. раздел «СДВГ-френдли» ниже.

---

## Архитектура (кратко)

- **Запуск:** `bun forge dev` — db (PocketBase), server (Express + Forge), client (Vite). Env: [env/.env.local](env/.env.local), [client/.env](client/.env) с `VITE_API_HOST`.
- **API:** Только через Forge API. Сервер — [server/src/core/routes/core.routes.ts](server/src/core/routes/core.routes.ts). Клиент — [client/src/forgeAPI.tsx](client/src/forgeAPI.tsx). **Модули не ходят в PocketBase с клиента** — никакого `new PocketBase('...')` в клиентском коде; всё через `forgeAPI.*`.
- **БД:** PocketBase, схемы в `server/src/lib/<module>/schema.ts` или `apps/<name>/server/schema.ts`, миграции — [listSchemaPaths](tools/src/commands/db/functions/schema-generation/listSchemaPaths.ts), именование коллекций `moduleName__collectionName`.
- **Копировать код из:** [apps/lifeforge--tasks](apps/lifeforge--tasks) (схемы tasks/habits, UI TaskDashboard), но вызовы заменить на forgeAPI; [client/src/core/dashboard](client/src/core/dashboard) (manifest, виджеты); [server/src/lib/user](server/src/lib/user) (forge, routes).

---

## 1. Запуск стека (Фаза 0)

- Env: `env/.env.local` (PORT, PB_HOST, PB_EMAIL, PB_PASSWORD, MASTER_KEY), `client/.env` (VITE_API_HOST). При 400 при `db init` — см. ревью (пароль, Windows).
- PocketBase: [database/pocketbase.exe](database/pocketbase.exe) или `bun forge db init`.
- Запуск: `bun forge dev` или по шагам (db → server → client). CORS: при «API offline» добавить URL клиента в [corsAllowedOrigins.ts](server/src/core/routes/constants/corsAllowedOrigins.ts).
- **Результат:** логин (email + пароль), дашборд. 2FA не использовать в UI (можно скрыть пункты).

---

## 2. Русская локализация

- Сначала: `bun forge locales add TedMeadow--lang-ru`. Если пакета нет — свой пакет по аналогии с [locales/lifeforge--lang-en](locales/lifeforge--lang-en): папка `lifeforge--lang-ru`, `package.json` (lifeforge.code: "ru", displayName: "Русский"), JSON по всем namespace из англ. пакета (accountSettings, auth, dashboard, sidebar, и т.д.).
- **Результат:** интерфейс на русском.

---

## 3. Тема: киберпанк + liquid glass

- Опираться на [packages/lifeforge-ui](packages/lifeforge-ui): [cyberpunk.css](packages/lifeforge-ui/src/styles/cyberpunk.css), [glassmorphism.css](packages/lifeforge-ui/src/styles/glassmorphism.css), GlassCard, NeonButton, CPProgressBar. Добирать при необходимости из [! Cyberpunk UI](!%20Cyberpunk%20UI) (example1–21) и [!liquidglass](!liquidglass).
- Пресет «Киберпанк» в персонализации: акцент, фон, шрифт + подключение cyberpunk.css (класс на корне или тема). Пресет «Liquid glass» — полупрозрачность/размытие через glassmorphism.
- Плавные анимации: [packages/lifeforge-ui/src/animations](packages/lifeforge-ui/src/animations).
- **Результат:** визуал в духе CP2077 и liquid glass без поломки модулей.

---

## 4. Задачи / привычки / ежедневные / заморозка (Habitica-подобно + СДВГ-френдли)

- Расширять [apps/lifeforge--tasks](apps/lifeforge--tasks) или вынести в core (`server/src/lib/tasks`, `server/src/lib/habits`). Коллекции: задачи (task/daily), привычки (good/bad/both, streak, history), при необходимости gamification.
- **Сразу перевести на forgeAPI:** в [apps/lifeforge--tasks/client/src/utils/api.ts](apps/lifeforge--tasks/client/src/utils/api.ts) убрать прямой PocketBase; на сервере добавить Forge-роуты (list, create, update, delete, toggleDay для привычек); клиент — вызовы `forgeAPI.tasks.*` / `forgeAPI.habits.*`.
- **Заморозка прогресса (обязательно):** коллекция `progress_freezes`: user, startDate, endDate, reason. Правило: не чаще раза в 2 месяца (при создании проверять последнюю паузу). При начислении XP/стрика проверять: дата не в активной паузе — иначе не начислять. UX: формулировки «взять паузу без потери прогресса», «следующая пауза доступна с …».
- Привычки по расписанию: поле `schedule` (json, например дни недели) в схеме привычки.
- **СДВГ-френдли (внедрить в п.4 или сразу после):**
- **«Мой день»:** вид по умолчанию для задач — только задачи на сегодня (или выбранные «на сегодня»). Не показывать весь бэклог сразу; непросроченное без вины возвращается в общий список. Опционально «Предложить добавить» из других списков (как в Microsoft To Do).
- **Быстрый захват:** добавление задачи в 1–2 клика (плавающая кнопка или поле вверху), без обязательного открытия модалки. При желании — распознавание естественного языка (NLP) для даты/приоритета («завтра в 10 p1» → задача с датой и приоритетом); можно отложить на фазу после MVP.
- **Подзадачи (шаги):** у задачи — поле `subtasks` (json массив) или отдельная связь «задача → подзадачи». Декомпозиция без перегруза интерфейса.
- **Виды:** кроме списка — опционально Kanban (колонки todo / in progress / done) и вид «Календарь» (месяц/неделя) для задач с датами. Переключатель видов на странице задач.
- **Геймификация — поощрительная по умолчанию:** не штрафовать за пропуски (никакого «потеря HP» по умолчанию). XP/уровень/аватар только за выполнение. Опционально в настройках: «строгий режим» (карательный) для тех, кому это помогает — явно выключен по умолчанию (по отчёту СДВГ карательная модель у многих вызывает стыд и избегание приложения).
- **Звук/фидбек при завершении:** опциональный приятный звук «динь» или короткая анимация при отметке задачи/привычки — немедленное подкрепление (как в Microsoft To Do).
- **Таймер фокуса (Pomodoro):** опционально — встроенный таймер (25 мин и т.д.), привязка сессии к одной задаче; при желании белый шум. Реализовать после базового списка задач или отдельной фазой.
- **Результат:** задачи, ежедневные, привычки, заморозка; СДВГ-ориентированный UX; всё через forgeAPI.

---

## 5. Графики для привычек и задач

- Библиотека: Recharts или Chart.js. На страницах привычек/задач: стрик по дням, календарь отметок (heatmap), выполнено по дням, распределение по приоритету. Адаптив под iPhone.
- **Результат:** красивые графики без перегруза.

---

## 6. Импорт Excel-планеров

- После п.4: данные импорта попадают в те же коллекции (tasks, habits). Парсинг: библиотека xlsx (на бэкенде или в tools). Маппинг по зафиксированной структуре: планер задач → поля задач, трекер привычек → поля привычек. Пилот — один тип (например планер задач), затем привычки/финансы при необходимости.
- **Результат:** загрузка xlsx и отображение в календаре/задачах/привычках.

---

## 7. Пиксельный персонаж (Habitica + киберпанк)

- Модуль/подмодуль «Аватар»: коллекция (user, level, xp, equipment/sprite). Правило: XP из задач/привычек суммируется, уровень по формуле (например level = floor(xp/100)+1). Спрайты: источник и формат зафиксировать (PocketBase file / статика / CDN). Отображение в сайдбаре или виджет на дашборде.
- **Результат:** пиксельный персонаж, связанный с прогрессом.

---

## 8. Заметки / блокнот / дневник побед

- Коллекция `notes__entries`: title, content (text/markdown), user, category (note | victory_diary). Дневник побед = фильтр по category. Редактор: markdown + превью (react-markdown или TipTap). Эмодзи: палитра или автодополнение (:code), список кодов в константах модуля.
- **Результат:** заметки с markdown и эмодзи, раздел «Дневник побед».

---

## 9. Инвайты и (опционально) психология / таро

- **Инвайты:** коллекция invites (code, createdBy, usedBy, usedAt, expiresAt). Регистрация: код + email + пароль; бэкенд проверяет код и создаёт пользователя. Страница «Инвайты» для создания кодов (админ/доверенные).
- **Психология/таро (MVP):** одна коллекция справочных карточек (типы личности, таро, когнитивные искажения), одна — тесты (вопросы json), одна — ответы пользователя. UI: списки, карточка, один простой тест. Без перегруза.
- **Результат:** вход по инвайту; опционально модуль психопрофиля/таро.

---

## 10. Мобильный UI (iPhone) и опционально PWA

- Viewport, тач-цели ≥44px, сайдбар в бургер на узком экране, полноширинные формы. По желанию: manifest.json, service worker, «Добавить на домашний экран».
- **Результат:** удобно с телефона.

---

## 11. Магазин (опционально)

- Валюта: решить — одна (XP с тратами) или вторая (кредиты). Коллекции: предметы, инвентарь пользователя. Связь с аватаром (снаряжение/скины). После п.4–7.
- **Результат:** при необходимости — простой магазин.

---

## Порядок выполнения (один агент — одна фича)

1. **П.1** — запуск стека (env, db init, dev).
2. **П.2** — русская локализация.
3. **П.3** — киберпанк + liquid glass тема.
4. **П.4** — задачи/привычки/ежедневные/заморозка + перевод модуля задач на forgeAPI (убрать прямой PB из api.ts). Включить СДВГ-френдли: «Мой день», быстрый захват, подзадачи, виды Список/Kanban/Календарь, поощрительная геймификация по умолчанию, звук/анимация при завершении; Pomodoro и NLP — по желанию в этой же фазе или позже.
5. **П.5** — графики привычек и задач.
6. **П.6** — импорт Excel (маппинг по !EXCEL, пилот по одному типу).
7. **П.7** — пиксельный персонаж.
8. **П.8** — заметки + дневник побед.
9. **П.9** — инвайты; при желании психология/таро (MVP).
10. **П.10** — мобильный UI (iPhone, PWA по желанию).
11. **П.11** — магазин по необходимости.

Каждый пункт — коммиты; сложные разбивать: схема → API → UI → локализация.

---

## Лучшие практики (не нарушать)

- **Только forgeAPI с клиента** — никакого PocketBase в браузере; один конфиг (VITE_API_HOST).
- **Единый стиль запросов:** forgeAPI + TanStack Query; типы с сервера.
- **Заморозка — про «прощение»:** тексты без морального давления, «следующая пауза доступна с …».
- **Ошибки и загрузки:** общий toast/обработчик, LoadingScreen/EmptyStateScreen из lifeforge-ui.
- **Локализация:** все новые строки в namespace модуля, не хардкод.
- **Новые модули:** изначально проектировать через Forge API и forgeAPI.
- **Принцип «перезапуска» (СДВГ):** хорошая система — та, в которую легко вернуться после выпадения. Не наказывать за возврат; простой «ритуал перезапуска» (например: очистить просроченное, выбрать 3 задачи на сегодня). Дефолтный вид «Мой день» этому способствует.
- **Не ловушка «архитектора»:** не делать бесконечную кастомизацию ради кастомизации; дефолт — простой интерфейс, расширенные настройки по желанию (из отчёта СДВГ: перегруженные Notion/ClickUp провоцируют прокрастинацию настройкой вместо дел).

---

## СДВГ-френдли (по отчёту «Топ-10 таск-трекеров для СДВГ»)

Референс: файл в Downloads «Топ-10 таск-трекеров для СДВГ._.txt». Что внедрить:

| Идея из отчёта | Внедрение в Life Control |
|----------------|---------------------------|
| Захват задачи до того, как мысль улетучилась | Быстрый ввод (1–2 клика), поле «Inbox» / вверху страницы; опционально NLP («завтра 10:00 p1»). |
| Фокус на «сейчас», не на всём списке | Вид «Мой день» по умолчанию; непросроченное без вины уходит обратно в список. |
| Поощрительная, а не карательная геймификация | XP/уровень только за выполнение; без «потери HP» по умолчанию; опция «строгий режим» выключена. |
| Легко вернуться после перерыва | Простой интерфейс, «ритуал перезапуска», заморозка как «пауза без потери». |
| Разные способы смотреть на задачи | Виды: Список, Kanban, Календарь (переключатель). |
| Декомпозиция пугающей задачи | Подзадачи у задачи; опционально позже — ИИ-декомпозиция (Goblin.Tools-style: одна задача → список шагов). |
| Доказательство усилий / время | Опционально Pomodoro/таймер фокуса, привязанный к задаче; статистика фокуса. |
| Мгновенный фидбек при выполнении | Звук «динь» или короткая анимация при отметке задачи/привычки. |
| Избегать перегруза интерфейса | Дефолт — минималистичный вид; расширенные настройки и виды — по желанию. |

**Опциональная фаза (после MVP):** ИИ-декомпозиция задачи (аналог Goblin.Tools Magic ToDo): пользователь вводит «Убраться на кухне» → API возвращает список подзадач; уровень детализации настраивается. Требует интеграции с AI (у тебя в плане «привязать ИИ-агента может в будущем» — это кандидат).

---

## Риски и проработки (чек-лист)

| Зона | Что проработать |
|------|------------------|
| Локали | TedMeadow--lang-ru или свой пакет; как список локалей тянется из locales/. |
| Тема | Как хранится/применяется пресет (персонализация, класс на корне). |
| Excel | Таблица: файл → листы → колонки; маппинг для пилота; библиотека xlsx, место парсинга. |
| Заморозка | Схема, правило «раз в 2 месяца», одна точка проверки при начислении прогресса. |
| Привычки по расписанию | Поле schedule (json) или отдельная сущность; пример значений. |
| Аватар | Источник спрайтов, формат, хранение; формула XP → level. |
| Заметки | Редактор (react-markdown vs TipTap); список эмодзи. |
| Инвайты | Схема, сценарий «код + регистрация»; кто создаёт инвайты. |
| Магазин | Одна валюта (XP) или вторая (кредиты); связь с уровнем аватара. |
| db init / Windows | При 400 — env без кавычек/BOM, передача пароля в superuser. |
| СДВГ-режим | «Мой день» как дефолт; геймификация поощрительная по умолчанию; настройка «строгий режим» (карательный) опциональна и выключена. |

---

## Важные файлы

- Доки: [!!!DOCUMENTATIONS.TXT](!!!DOCUMENTATIONS.TXT). Планеры: [!EXCEL](!EXCEL). Киберпанк: [! Cyberpunk UI](!%20Cyberpunk%20UI). Стекло: [!liquidglass](!liquidglass). СДВГ-референс: отчёт «Топ-10 таск-трекеров для СДВГ» (файл в Downloads: `Топ-10 таск-трекеров для СДВГ._.txt`).
- Env / CORS: env/.env.local, client/.env, [corsAllowedOrigins.ts](server/src/core/routes/constants/corsAllowedOrigins.ts).
- Клиент: [client/src/forgeAPI.tsx](client/src/forgeAPI.tsx), [loadCoreModules.ts](client/src/federation/loaders/loadCoreModules.ts), [client/src/core](client/src/core).
- Сервер: [core.routes.ts](server/src/core/routes/core.routes.ts), [server/src/lib](server/src/lib).
- Модуль задач (до рефактора): [apps/lifeforge--tasks](apps/lifeforge--tasks); **[api.ts](apps/lifeforge--tasks/client/src/utils/api.ts)** — заменить на forgeAPI.
- UI: [packages/lifeforge-ui](packages/lifeforge-ui) (cyberpunk.css, glassmorphism.css, GlassCard, NeonButton, CPProgressBar).
- Tools/миграции: [tools/src/commands/db](tools/src/commands/db).